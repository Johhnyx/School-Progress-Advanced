<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School Progress</title>

  <style>
    *{ box-sizing:border-box; }
    body{
      font-family: Arial, sans-serif;
      background:#f4f4f4;
      margin:0;
      padding:24px;
      color:#222;
    }
    .wrap{ max-width:1080px; margin:0 auto; }
    h1{
      margin:0 0 14px 0;
      text-align:center;
      font-weight:900;
      letter-spacing:0.2px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      margin-bottom:12px;
    }
    .btn{
      border:none;
      padding:10px 12px;
      border-radius:10px;
      background:#111;
      color:#fff;
      font-weight:800;
      cursor:pointer;
      white-space:nowrap;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width:900px){
      .grid2{ grid-template-columns: 1fr; }
      body{ padding:16px; }
    }

    .colHead{
      text-align:center;
      font-weight:900;
      color:#666;
      margin:0 0 8px 0;
      font-size:13px;
      letter-spacing:0.3px;
    }

    .block{
      background:#fff;
      padding:16px 16px 12px;
      border-radius:12px;
      margin:12px 0;
      box-shadow:0 2px 10px rgba(0,0,0,0.06);
    }
    .rowTitle{
      margin:0 0 10px 0;
      font-size:18px;
      font-weight:900;
    }

    .line{
      position:relative;
      width:100%;
      height:3px;
      background:#e0e0e0;
      border-radius:999px;
      overflow:hidden;
    }
    .fill{
      position:absolute;
      left:0; top:0;
      height:100%;
      width:0%;
      background:#3bb54a;
      border-radius:999px;
      transition: width 0.35s ease;
    }
    .fill.weekend{ background:#ff9800; }

    .label{
      margin:10px 0 0 0;
      font-weight:800;
    }

    .hint{
      margin:10px 0 0 0;
      color:#666;
      font-size:13px;
      line-height:1.35;
    }

    .hidden{ display:none; }
    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
      margin:8px 0;
      font-weight:800;
    }

    /* Daily */
    .dailyRow{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .badge{
      padding:6px 10px;
      border-radius:999px;
      background:#eee;
      font-weight:900;
      font-size:13px;
    }
    .badge.live{ background:#e8f5e9; }
    .badge.free{ background:#fff3cd; } /* ≈ælut√° */
    .badge.err{ background:#fdecea; }
    .dailyText{ font-weight:800; }

    .iframe{
      width:100%;
      height:520px;
      border:1px solid #eee;
      border-radius:10px;
    }

    .statusOk{ color:#0a7a1f; font-weight:900; }
    .statusBad{ color:#b00020; font-weight:900; }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>School Progress</h1>

    <div class="topbar">
      <button id="settingsBtn" class="btn" type="button">Nastaven√≠ ‚öôÔ∏è</button>
    </div>

    <div id="settingsPanel" class="block hidden">
      <div class="rowTitle">Nastaven√≠</div>

      <label class="toggle">
        <input type="checkbox" id="toggleTimetable" checked />
        <span>Zobrazit rozvrh</span>
      </label>

      <label class="toggle">
        <input type="checkbox" id="toggleDaily" checked />
        <span>Zobrazit denn√≠ progres</span>
      </label>

      <p class="hint" id="statusHint">Status: inicializace‚Ä¶</p>
    </div>

    <!-- 2 sloupce: Real-Time vs Raw-Time -->
    <div class="grid2">
      <!-- LEFT = Real-Time -->
      <div>
        <div class="colHead">Real-Time</div>

        <div class="block">
          <div class="rowTitle">T√Ωden</div>
          <div class="line"><div class="fill" id="rt-week"></div></div>
          <p class="label" id="rt-week-label"></p>
        </div>

        <div class="block">
          <div class="rowTitle">Mƒõs√≠c</div>
          <div class="line"><div class="fill" id="rt-month"></div></div>
          <p class="label" id="rt-month-label"></p>
        </div>

        <div class="block">
          <div class="rowTitle">≈†koln√≠ rok</div>
          <div class="line"><div class="fill" id="rt-year"></div></div>
          <p class="label" id="rt-year-label"></p>
        </div>

        <div class="block">
          <div class="rowTitle">Celkem</div>
          <div class="line"><div class="fill" id="rt-total"></div></div>
          <p class="label" id="rt-total-label"></p>
        </div>

        <div class="block">
          <div class="rowTitle">Maturita</div>
          <p class="label" id="rt-maturita-label"></p>
        </div>
      </div>

      <!-- RIGHT = Raw-Time -->
      <div>
        <div class="colHead">Raw-Time</div>

        <div class="block">
          <div class="rowTitle">T√Ωden</div>
          <div class="line"><div class="fill" id="raw-week"></div></div>
          <p class="label" id="raw-week-label"></p>
        </div>

        <div class="block">
          <div class="rowTitle">Mƒõs√≠c</div>
          <div class="line"><div class="fill" id="raw-month"></div></div>
          <p class="label" id="raw-month-label"></p>
        </div>

        <div class="block">
          <div class="rowTitle">≈†koln√≠ rok</div>
          <div class="line"><div class="fill" id="raw-year"></div></div>
          <p class="label" id="raw-year-label"></p>
        </div>

        <div class="block">
          <div class="rowTitle">Celkem</div>
          <div class="line"><div class="fill" id="raw-total"></div></div>
          <p class="label" id="raw-total-label"></p>
        </div>

        <div class="block">
          <div class="rowTitle">Maturita</div>
          <p class="label" id="raw-maturita-label"></p>
        </div>
      </div>
    </div>

    <!-- Daily -->
    <div id="dailyBlock" class="block">
      <div class="rowTitle">Denn√≠ progres</div>
      <div class="dailyRow">
        <div class="badge" id="dailyBadge">Rozvrh</div>
        <div class="dailyText" id="dailyText">Naƒç√≠t√°m rozvrh‚Ä¶</div>
      </div>
      <div class="line" style="margin-top:10px;">
        <div class="fill" id="daybar"></div>
      </div>
      <p class="label" id="daylabel"></p>
      <p class="hint" id="dailyDebug"></p>
    </div>

    <!-- Timetable -->
    <div id="timetableBlock" class="block">
      <div class="rowTitle">Rozvrh</div>
      <div class="hint">Zdroj: ve≈ôejn√Ω Bakal√°≈ôi (Actual)</div>
      <iframe class="iframe"
              src="https://1kspa-kladno.bakalari.cz/Timetable/Public/Actual/Class/5A"
              loading="lazy"
              referrerpolicy="no-referrer"></iframe>
    </div>
  </div>

  <script>
    // ==============================
    // CONFIG
    // ==============================
    const TIMETABLE_URL = "https://1kspa-kladno.bakalari.cz/Timetable/Public/Actual/Class/5A";
    const CORS_PROXY = "https://api.allorigins.win/raw?url=";

    // 4 roky dohromady
    const HS_START = localDate(2023, 9, 4);
    const HS_END   = localDateEnd(2027, 6, 30);

    // Maturita: chce≈° "obvykle" a staƒç√≠ mƒõs√≠c ‚Üí orientaƒçnƒõ kvƒõten 2027 (1.5.)
    const MATURITA_APPROX = localDateEnd(2027, 5, 1);

    // RAW: pr√°zdniny/volna (bez v√≠kend≈Ø + bez pr√°zdnin, vƒç letn√≠ch)
    const BREAKS = [
      // 2023/24
      r("2023-10-26","2023-10-27"),
      r("2023-12-23","2024-01-02"),
      r("2024-02-02","2024-02-02"),
      r("2024-02-26","2024-03-03"),
      r("2024-07-01","2024-08-31"),

      // 2024/25
      r("2024-10-29","2024-10-30"),
      r("2024-12-23","2025-01-03"),
      r("2025-01-31","2025-01-31"),
      r("2025-03-03","2025-03-09"),
      r("2025-07-01","2025-08-31"),

      // 2025/26
      r("2025-10-27","2025-10-29"),
      r("2025-12-22","2026-01-02"),
      r("2026-01-30","2026-01-30"),
      r("2026-03-09","2026-03-15"),
      r("2026-07-01","2026-08-31"),

      // 2026/27
      r("2026-10-29","2026-10-30"),
      r("2026-12-23","2027-01-03"),
      r("2027-01-29","2027-01-29"),
      r("2027-02-01","2027-02-07"),
    ];

    // ≈ôeditelsk√© volno dopl≈à sem (ISO datumy)
    const DIRECTOR_DAYS = [
      // "2026-11-20",
    ];

    // ==============================
    // STATE
    // ==============================
    let timetable = null; // { times:[{startMin,endMin}], days:{Mon:[{subj,room}...],...} }
    let timetableStatus = "Naƒç√≠t√°m rozvrh‚Ä¶";

    // ==============================
    // DOM helpers
    // ==============================
    const $ = (id) => document.getElementById(id);
    const clamp = (x, a=0, b=100) => Math.max(a, Math.min(b, x));
    const setBar = (id, pct, weekend=false) => {
      const n = $(id);
      if (!n) return;
      n.style.width = clamp(pct).toFixed(2) + "%";
      if (weekend) n.classList.add("weekend"); else n.classList.remove("weekend");
    };
    const setText = (id, txt) => { const n=$(id); if(n) n.textContent = txt; };

    // ==============================
    // Date helpers
    // ==============================
    function localDate(y,m,d){ const dt=new Date(y,m-1,d); dt.setHours(0,0,0,0); return dt; }
    function localDateEnd(y,m,d){ const dt=new Date(y,m-1,d); dt.setHours(23,59,59,999); return dt; }

    function toISO(d){
      const y=d.getFullYear();
      const m=String(d.getMonth()+1).padStart(2,'0');
      const da=String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${da}`;
    }
    function r(s,e){ return {s,e}; }
    function inBreak(iso){ return BREAKS.some(x => iso>=x.s && iso<=x.e); }

    function isSchoolDay(d){
      const dow = d.getDay();
      if (dow===0 || dow===6) return false;
      const iso = toISO(d);
      if (DIRECTOR_DAYS.includes(iso)) return false;
      if (inBreak(iso)) return false;
      return true;
    }

    function countSchoolDays(start, end){
      const s = new Date(start); s.setHours(0,0,0,0);
      const e = new Date(end);   e.setHours(23,59,59,999);
      let c=0;
      const cur = new Date(s);
      while (cur <= e){
        if (isSchoolDay(cur)) c++;
        cur.setDate(cur.getDate()+1);
      }
      return c;
    }

    function calendarPctBetween(start, end, now){
      const total = end - start;
      if (total<=0) return 0;
      const passed = Math.min(Math.max(now-start, 0), total);
      return (passed/total)*100;
    }

    function rawPctBetween(start, end, now){
      const total = countSchoolDays(start, end);
      const clipped = now < start ? start : (now > end ? end : now);
      const passed = countSchoolDays(start, clipped);
      return total ? (passed/total)*100 : 0;
    }

    function rawDaysUntil(target, now){
      const start = new Date(now); start.setHours(0,0,0,0);
      const end = new Date(target); end.setHours(23,59,59,999);
      if (end < start) return -countSchoolDays(end, start);
      return countSchoolDays(start, end);
    }

    // ≈†koln√≠ rok (1.9 ‚Äì 30.6)
    function getSchoolYearRange(now){
      const y = (now.getMonth()>=8) ? now.getFullYear() : now.getFullYear()-1;
      return { start: localDate(y,9,1), end: localDateEnd(y+1,6,30) };
    }

    // ==============================
    // Settings UI
    // ==============================
    function initSettings(){
      const btn = $("settingsBtn");
      const panel = $("settingsPanel");
      const toggleTT = $("toggleTimetable");
      const toggleDaily = $("toggleDaily");
      const timetableBlock = $("timetableBlock");
      const dailyBlock = $("dailyBlock");

      btn.addEventListener("click", () => panel.classList.toggle("hidden"));
      toggleTT.addEventListener("change", () => timetableBlock.classList.toggle("hidden", !toggleTT.checked));
      toggleDaily.addEventListener("change", () => dailyBlock.classList.toggle("hidden", !toggleDaily.checked));
    }

    // ==============================
    // Timetable fetch + parse
    // (robustn√≠: parsuje a≈æ od "Mon dd/mm", tak≈æe DN3 nikdy nevezme)
    // ==============================
    async function loadTimetable(){
      try{
        timetableStatus = "Naƒç√≠t√°m rozvrh‚Ä¶";
        setDailyLoading();

        const res = await fetch(CORS_PROXY + encodeURIComponent(TIMETABLE_URL), { cache:"no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const html = await res.text();

        const doc = new DOMParser().parseFromString(html, "text/html");
        const text = (doc.body ? doc.body.innerText : "") || "";

        timetable = parseFromScheduleText(text);
        timetableStatus = "Rozvrh naƒçten ‚úî";

        const monCount = timetable.days.Mon.filter(x=>x).length;
        setText("dailyDebug", `Parser OK: hodin=${timetable.times.length}, Po=${monCount}`);
      } catch(e){
        timetable = null;
        timetableStatus = "Rozvrh se nepoda≈ôilo naƒç√≠st / parsovat (proxy/CORS).";
        setDailyError(timetableStatus);
        setText("dailyDebug", String(e && e.message ? e.message : e));
      } finally {
        setStatus();
      }
    }

    function parseFromScheduleText(text){
      // 1) ƒçasy hodin
      const timeRe = /(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})/g;
      const times = [];
      let m;
      while ((m = timeRe.exec(text)) !== null){
        const sMin = parseInt(m[1],10)*60 + parseInt(m[2],10);
        const eMin = parseInt(m[3],10)*60 + parseInt(m[4],10);
        if (!times.some(t => t.startMin===sMin && t.endMin===eMin)){
          times.push({startMin:sMin, endMin:eMin});
        }
      }
      times.sort((a,b)=>a.startMin-b.startMin);
      if (!times.length) throw new Error("Nenalezeny ƒçasy hodin.");

      // 2) vezmeme jen ƒç√°st od prvn√≠ho dne (Mon ..)
      const lines = text.split("\n").map(x=>x.trim()).filter(Boolean);

      const dayMarkers = ["Mon","Tue","Wed","Thu","Fri"];
      const dayIdx = {};
      for (const d of dayMarkers){
        const i = lines.findIndex(x => new RegExp("^" + d + "\\s+\\d{1,2}\\/\\d{1,2}$").test(x));
        if (i >= 0) dayIdx[d] = i;
      }

      if (!("Mon" in dayIdx)) throw new Error("Nenalezen blok 'Mon dd/mm'.");

      // z√≠skat segmenty pro dny
      function sliceDay(d){
        const start = dayIdx[d];
        if (start === undefined) return [];
        const nextDay = dayMarkers.find(dd => (dayIdx[dd] !== undefined) && dayIdx[dd] > start);
        const end = nextDay ? dayIdx[nextDay] : lines.length;
        return lines.slice(start+1, end);
      }

      const segments = {
        Mon: sliceDay("Mon"),
        Tue: sliceDay("Tue"),
        Wed: sliceDay("Wed"),
        Thu: sliceDay("Thu"),
        Fri: sliceDay("Fri"),
      };

      const days = { Mon:[], Tue:[], Wed:[], Thu:[], Fri:[] };
      for (const d of dayMarkers){
        days[d] = parseDaySegment(segments[d], times.length);
      }

      return { times, days };
    }

    function parseDaySegment(segLines, maxLessons){
      // Form√°t v Actual view typicky:
      // uƒç10, MAT, RYB, uƒç10, RUJ, ZYJ, uƒç11, NEJ, PRH, ...
      // Nƒõkdy nav√≠c "ANJ1 / ANJ2" (skupiny) -> chceme ignorovat a vz√≠t ANJ + uƒçebnu.
      const roomRe = /^(uƒç|uc|TV|VT|KLB)\s*\d*$/i;
      const teacherRe = /^[A-Z√Åƒåƒé√âƒö√ç≈á√ì≈ò≈†≈§√ö≈Æ√ù≈Ω]{3}$/;     // RYB, KLE...
      const subjRe = /^[A-Z√Åƒåƒé√âƒö√ç≈á√ì≈ò≈†≈§√ö≈Æ√ù≈Ω]{2,6}\d?$/;    // MAT, SWA, ANJ1...

      const out = [];
      let lastRoom = null;

      function normRoom(x){
        if (!x) return null;
        // sjednot√≠me "uƒç10" -> "uƒç10"
        const m = x.match(/(uƒç|uc|TV|VT|KLB)\s*(\d*)/i);
        if (!m) return x;
        const prefix = m[1].toLowerCase() === "uc" ? "uƒç" : m[1];
        const num = m[2] || "";
        return (prefix + num).toLowerCase();
      }

      for (let i=0; i<segLines.length; i++){
        const token = segLines[i];

        // ignoruj ≈°um
        if (/^DN\d+$/i.test(token)) continue;

        // room
        if (roomRe.test(token)){
          lastRoom = normRoom(token);
          continue;
        }

        // teacher
        if (teacherRe.test(token)) continue;

        // subject-ish
        if (subjRe.test(token)){
          // ignoruj group label ANJ1/ANJ2 (chceme ANJ a≈æ p≈ôijde)
          if (/^ANJ\d$/i.test(token)) continue;

          const subj = token.toUpperCase();
          if (!lastRoom) {
            // nƒõkdy se room objev√≠ a≈æ p≈ôedchoz√≠/p≈ô√≠≈°t√≠ ‚Äì zat√≠m nech room null
            out.push({ subj, room: null });
          } else {
            out.push({ subj, room: lastRoom });
          }

          // collapse duplicit typu "ANJ uƒç2" opakovanƒõ
          const n = out.length;
          if (n >= 2){
            const a = out[n-1], b = out[n-2];
            if (a.subj === b.subj && a.room === b.room){
              out.pop();
            }
          }

          if (out.length >= maxLessons) break;
        }
      }

      // dopl≈à na maxLessons null
      while (out.length < maxLessons) out.push(null);
      return out;
    }

    // ==============================
    // Daily UI
    // ==============================
    function setDailyLoading(){
      const b=$("dailyBadge"); b.className="badge"; b.textContent="Rozvrh";
      setText("dailyText","Naƒç√≠t√°m rozvrh‚Ä¶");
      setBar("daybar",0);
      setText("daylabel","");
    }
    function setDailyError(msg){
      const b=$("dailyBadge"); b.className="badge err"; b.textContent="Chyba";
      setText("dailyText",msg);
      setBar("daybar",0);
      setText("daylabel","");
    }
    function setDailyFree(){
      const b=$("dailyBadge"); b.className="badge free"; b.textContent="Volno";
      setText("dailyText","Volno üòé");
      setBar("daybar",100);
      setText("daylabel","");
    }

    function minutesToHHMM(min){
      const h=String(Math.floor(min/60)).padStart(2,"0");
      const m=String(min%60).padStart(2,"0");
      return `${h}:${m}`;
    }

    function fmtLesson(x){
      if (!x || !x.subj) return null;
      if (x.room) return `${x.subj} (${x.room})`;
      return `${x.subj}`;
    }

    function updateDaily(now){
      const dow = now.getDay();
      if (dow===0 || dow===6){ setDailyFree(); return; }

      if (!timetable){
        setDailyError(timetableStatus);
        return;
      }

      const key = (dow===1)?"Mon":(dow===2)?"Tue":(dow===3)?"Wed":(dow===4)?"Thu":"Fri";
      const times = timetable.times;
      const lessons = (timetable.days[key] || []).slice(0, times.length);

      const nowMin = now.getHours()*60 + now.getMinutes();
      const first = times[0];
      const last  = times[times.length-1];

      if (nowMin > last.endMin){
        setDailyFree();
        return;
      }

      if (nowMin < first.startMin){
        const b=$("dailyBadge"); b.className="badge live"; b.textContent="Dnes";
        const next = fmtLesson(lessons[0]) || "Hodina 1";
        setText("dailyText",`Za chv√≠li zaƒçne: ${next}`);
        setBar("daybar",0);
        setText("daylabel",`Start v ${minutesToHHMM(first.startMin)}`);
        return;
      }

      for (let i=0;i<times.length;i++){
        const t=times[i];
        const cur = fmtLesson(lessons[i]) || `Hodina ${i+1}`;
        const next = (i+1<times.length) ? (fmtLesson(lessons[i+1]) || `Hodina ${i+2}`) : null;

        if (nowMin >= t.startMin && nowMin <= t.endMin){
          const pct = ((nowMin - t.startMin) / Math.max(1,(t.endMin - t.startMin))) * 100;
          const b=$("dailyBadge"); b.className="badge live"; b.textContent="Pr√°vƒõ";
          setText("dailyText", next ? `Pr√°vƒõ: ${cur} ‚Ä¢ Dal≈°√≠: ${next}` : `Pr√°vƒõ: ${cur}`);
          setBar("daybar", pct);
          setText("daylabel", `Hodina ${i+1} ‚Ä¢ ${minutesToHHMM(t.startMin)}‚Äì${minutesToHHMM(t.endMin)} ‚Ä¢ ${pct.toFixed(0)}%`);
          return;
        }

        const nt = times[i+1];
        if (nt && nowMin > t.endMin && nowMin < nt.startMin){
          const b=$("dailyBadge"); b.className="badge live"; b.textContent="Pauza";
          setText("dailyText", `N√°sleduje: ${next}`);
          setBar("daybar", 0);
          setText("daylabel", `Dal≈°√≠ hodina v ${minutesToHHMM(nt.startMin)}`);
          return;
        }
      }

      setDailyFree();
    }

    // ==============================
    // MAIN update
    // ==============================
    function updateAll(){
      const now = new Date();
      const timeInDay = now.getHours()/24 + now.getMinutes()/1440;

      const dow = now.getDay();
      const weekend = (dow===0 || dow===6);
      const workIndex = (dow===1)?0:(dow===2)?1:(dow===3)?2:(dow===4)?3:(dow===5)?4:4;
      const weekPct = weekend ? 100 : ((workIndex + timeInDay)/5)*100;

      // Week
      setBar("rt-week", weekPct, weekend);
      setText("rt-week-label", weekend ? "Weekend üòé" : `T√Ωden: ${weekPct.toFixed(1)}%`);
      setBar("raw-week", weekPct, false);
      setText("raw-week-label", `T√Ωden: ${weekPct.toFixed(1)}%`);

      // Month realtime
      const dim = new Date(now.getFullYear(), now.getMonth()+1, 0).getDate();
      const monthPct = ((now.getDate()-1 + timeInDay)/dim)*100;
      setBar("rt-month", monthPct);
      setText("rt-month-label", `Mƒõs√≠c: ${monthPct.toFixed(1)}%`);

      // Month raw
      const mStart = localDate(now.getFullYear(), now.getMonth()+1, 1);
      const mEnd   = localDateEnd(now.getFullYear(), now.getMonth()+1, dim);
      const monthRaw = rawPctBetween(mStart, mEnd, now);
      setBar("raw-month", monthRaw);
      setText("raw-month-label", `Mƒõs√≠c: ${monthRaw.toFixed(1)}%`);

      // School year
      const yr = getSchoolYearRange(now);
      const yearPct = calendarPctBetween(yr.start, yr.end, now);
      setBar("rt-year", yearPct);
      setText("rt-year-label", `≈†koln√≠ rok: ${yearPct.toFixed(1)}%`);
      const yearRaw = rawPctBetween(yr.start, yr.end, now);
      setBar("raw-year", yearRaw);
      setText("raw-year-label", `≈†koln√≠ rok: ${yearRaw.toFixed(1)}%`);

      // Total
      const totalPct = calendarPctBetween(HS_START, HS_END, now);
      setBar("rt-total", totalPct);
      setText("rt-total-label", `Celkem: ${totalPct.toFixed(1)}%`);
      const totalRaw = rawPctBetween(HS_START, HS_END, now);
      setBar("raw-total", totalRaw);
      setText("raw-total-label", `Celkem: ${totalRaw.toFixed(1)}%`);

      // Maturita
      const daysUntil = Math.ceil((MATURITA_APPROX - now) / (1000*60*60*24));
      setText("rt-maturita-label",
        (daysUntil>=0)
          ? `Real-Time: ~${daysUntil} dn√≠ (kvƒõten 2027)`
          : `Real-Time: hotovo (${Math.abs(daysUntil)} dn√≠ zpƒõt)`
      );

      const rawDays = rawDaysUntil(MATURITA_APPROX, now);
      setText("raw-maturita-label",
        (rawDays>=0)
          ? `Raw-Time: ~${rawDays} ≈°koln√≠ch dn√≠ (bez v√≠kend≈Ø/pr√°zdnin)`
          : `Raw-Time: hotovo (${Math.abs(rawDays)} ≈°koln√≠ch dn√≠ zpƒõt)`
      );

      // Daily
      const toggleDaily = $("toggleDaily");
      if (!toggleDaily || toggleDaily.checked){
        updateDaily(now);
      }

      setStatus(true);
    }

    function setStatus(ok=true){
      const el = $("statusHint");
      if (!el) return;
      const base = timetable ? "Rozvrh: OK" : ("Rozvrh: " + timetableStatus);
      el.innerHTML = ok
        ? `<span class="statusOk">Status: OK</span> ‚Ä¢ ${base}`
        : `<span class="statusBad">Status: CHYBA</span> ‚Ä¢ ${base}`;
    }

    // ==============================
    // BOOT
    // ==============================
    function boot(){
      initSettings();

      try{ updateAll(); } catch(e){
        timetableStatus = "JS chyba: " + e.message;
        setStatus(false);
      }

      loadTimetable().finally(() => {
        try{ updateAll(); } catch(e){
          timetableStatus = "JS chyba po rozvrhu: " + e.message;
          setStatus(false);
        }
      });

      setInterval(() => {
        try{ updateAll(); } catch(e){
          timetableStatus = "JS chyba v interval: " + e.message;
          setStatus(false);
        }
      }, 30_000);
    }

    document.addEventListener("DOMContentLoaded", boot);
  </script>
</body>
</html>